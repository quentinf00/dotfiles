# History
HISTFILE=~/.zsh_history
HISTSIZE=10000
SAVEHIST=10000
setopt append_history
setopt hist_ignore_dups
setopt hist_ignore_space
setopt share_history

# Options
setopt glob_dots
setopt no_auto_menu
setopt interactive_comments

# Completions
autoload -Uz compinit
compinit
zstyle ':completion:*' matcher-list 'm:{a-z}={A-Z}'
zstyle ':completion:*' menu select

# Environment
export EDITOR=nvim
export DO_NOT_TRACK=true
export HDF5_USE_FILE_LOCKING=FALSE
export PATH="$HOME/bin:$HOME/.pixi/bin:$PATH"
export PATH="$PATH:$HOME/.pixi/envs/nodejs/bin"

# Plugins
source ~/.zsh/plugins/zsh-autosuggestions/zsh-autosuggestions.zsh
source ~/.zsh/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh

# fzf (Ctrl-R: history, Ctrl-T: file picker, Alt-C: cd to dir)
eval "$(fzf --zsh)"
export FZF_DEFAULT_COMMAND='fd --type f --hidden --exclude .git'
export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
export FZF_ALT_C_COMMAND='fd --type d --hidden --exclude .git'

# Aliases
alias ls='eza --icons --group-directories-first'
alias ll='eza --icons --group-directories-first -l'
alias la='eza --icons --group-directories-first -la'
alias tree='eza --icons --tree -L 3 --group-directories-first'

# Yazi with cd-on-exit
function y() {
    local tmp="$(mktemp -t "yazi-cwd.XXXXXX")" cwd
    yazi "$@" --cwd-file="$tmp"
    if cwd="$(command cat -- "$tmp")" && [ -n "$cwd" ] && [ "$cwd" != "$PWD" ]; then
        builtin cd -- "$cwd"
    fi
    rm -f -- "$tmp"
}

# Tools (starship must be last)
eval "$(zoxide init zsh)"
eval "$(starship init zsh)"
